{% if show_wrapper %}<div id="dest_restic" class="hidden">{% endif %}
    <div class="form-group">
        <label for="restic_repo_type">Repository Type:</label>
        <select id="restic_repo_type" name="restic_repo_type" 
                hx-post="/htmx/restic-repo-fields"
                hx-target="#restic_repo_fields_container"
                hx-swap="innerHTML"
                hx-trigger="change"
                hx-include="this">
            <option value="">Select repository type...</option>
            {% for repo_type in available_repository_types %}
            <option value="{{ repo_type.value }}" {% if repo_type.value == selected_repo_type %}selected{% endif %}>
                {{ repo_type.display_name }}
            </option>
            {% endfor %}
        </select>
    </div>
    
    <div class="form-group">
        <label for="restic_password">Repository Password:</label>
        {% set field_id = 'restic_password' %}
        {% set field_name = 'restic_password' %}
        {% set field_value = restic_password %}
        {% set placeholder = 'Strong repository password' %}
        {% set hidden = true %}
        {% include 'partials/password_field.html' %}
        <div class="help-text">This password encrypts your entire backup repository. Store it securely!</div>
    </div>
    
    <!-- Container for HTMX-rendered repository fields -->
    <div id="restic_repo_fields_container">
        <!-- Repository-specific fields will be rendered here by HTMX -->
        {{ repo_fields_html | safe }}
    </div>
    
    {% set endpoint = "/htmx/validate-restic" %}
    {% set target = "#restic_validation_status" %}
    {% set target_id = "restic_validation_status" %}
    {% set button_text = "Validate Restic Configuration" %}
    {% include 'partials/validation_button_with_results.html' %}
    
    <!-- Include Restic utilities for initialization -->
    <script src="/static/restic-utils.js"></script>
    
    <!-- Repository Maintenance -->
    {% include 'partials/job_form_maintenance.html' %}
{% if show_wrapper %}</div>{% endif %}