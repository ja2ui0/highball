<!DOCTYPE html>
<html>
<head>
    <title>Configuration Manager - Highball</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="/static/nav.js"></script>
    <script src="/static/config-manager.js"></script>
</head>
<body>
    <div class="container">
        <div id="navigation"></div>
        
        <h1>Configuration Manager</h1>
        
        
        <form method="post" action="/save-config">
            
            <!-- Global Settings -->
            <div class="config-section">
                <h3>Global Settings</h3>
                
                <div class="form-group">
                    <label for="scheduler_timezone">Scheduler Timezone:</label>
                    <input type="text" id="scheduler_timezone" name="scheduler_timezone" 
                           value="{{SCHEDULER_TIMEZONE}}" placeholder="UTC">
                    <div class="help-text">Timezone for scheduled jobs (e.g., America/Denver, UTC)</div>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" name="enable_conflict_avoidance" {{ENABLE_CONFLICT_AVOIDANCE}}> 
                        Enable Conflict Avoidance
                    </label>
                    <div class="help-text">Jobs with shared resources will wait for each other to finish</div>
                </div>
                
                <div class="form-group">
                    <label for="conflict_check_interval">Conflict Check Interval (seconds):</label>
                    <input type="number" id="conflict_check_interval" name="conflict_check_interval" 
                           value="{{CONFLICT_CHECK_INTERVAL}}" placeholder="300">
                    <div class="help-text">How often to check for conflicting jobs (default: 300)</div>
                </div>
                
                <div class="form-group">
                    <label for="delay_notification_threshold">Delay Notification Threshold (seconds):</label>
                    <input type="number" id="delay_notification_threshold" name="delay_notification_threshold" 
                           value="{{DELAY_NOTIFICATION_THRESHOLD}}" placeholder="300">
                    <div class="help-text">Send notification after jobs are delayed this long (default: 300)</div>
                </div>
            </div>
            
            <!-- Schedule Defaults -->
            <div class="config-section">
                <h3>Default Schedule Times</h3>
                <p>These are the default times used when you select "Daily", "Weekly", or "Hourly" schedules.</p>
                
                <div class="form-group">
                    <label for="hourly_default">Hourly Default:</label>
                    <input type="text" id="hourly_default" name="hourly_default" 
                           value="{{HOURLY_DEFAULT}}" placeholder="0 * * * *">
                    <div class="help-text">Default ("0 * * * *" aka: top of every hour)</div>
                </div>
                
                <div class="form-group">
                    <label for="daily_default">Daily Default:</label>
                    <input type="text" id="daily_default" name="daily_default" 
                           value="{{DAILY_DEFAULT}}" placeholder="0 3 * * *">
                    <div class="help-text">Default ("0 3 * * *" aka: 3:00 AM daily)</div>
                </div>
                
                <div class="form-group">
                    <label for="weekly_default">Weekly Default:</label>
                    <input type="text" id="weekly_default" name="weekly_default" 
                           value="{{WEEKLY_DEFAULT}}" placeholder="0 3 * * 0">
                    <div class="help-text">Default ("0 3 * * 0" aka: Sunday 3:00 AM)</div>
                </div>
                
                <div class="form-group">
                    <label for="monthly_default">Monthly Default:</label>
                    <input type="text" id="monthly_default" name="monthly_default" 
                           value="{{MONTHLY_DEFAULT}}" placeholder="0 3 1 * *">
                    <div class="help-text">Default ("0 3 1 * *" aka: first of month 3:00 AM)</div>
                </div>
            </div>
            
            <!-- Notification Settings -->
            <div class="config-section">
                <h3>Notification Settings</h3>
                
                <!-- Telegram Settings -->
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="enable_telegram" name="enable_telegram" {{TELEGRAM_ENABLED}} onchange="toggleTelegramSettings()"> 
                        Enable Telegram notifications
                    </label>
                </div>
                
                <div id="telegramSettings" class="method-settings {{TELEGRAM_SETTINGS_CLASS}}">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" name="telegram_notify_success" {{TELEGRAM_NOTIFY_SUCCESS}}> 
                            Notify on successful jobs via Telegram
                        </label>
                        <div class="help-text">Get Telegram notifications when backup jobs complete successfully (in addition to failures and delays)</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="telegram_token">Bot Token:</label>
                        <input type="text" id="telegram_token" name="telegram_token" 
                               value="{{TELEGRAM_TOKEN}}" placeholder="1234567890:ABCdefGHIjklMNOpqrsTUVwxyz">
                        <div class="help-text">Get from @BotFather on Telegram</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="telegram_chat_id">Chat ID:</label>
                        <input type="text" id="telegram_chat_id" name="telegram_chat_id" 
                               value="{{TELEGRAM_CHAT_ID}}" placeholder="-1001234567890">
                        <div class="help-text">Chat or group ID where notifications will be sent</div>
                    </div>
                </div>
                
                <!-- Email Settings -->
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="enable_email" name="enable_email" {{EMAIL_ENABLED}} onchange="toggleEmailSettings()"> 
                        Enable email notifications
                    </label>
                </div>
                
                <div id="emailSettings" class="method-settings {{EMAIL_SETTINGS_CLASS}}">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" name="email_notify_success" {{EMAIL_NOTIFY_SUCCESS}}> 
                            Notify on successful jobs via email
                        </label>
                        <div class="help-text">Get email notifications when backup jobs complete successfully (in addition to failures and delays)</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="email_smtp_server">SMTP Server:</label>
                        <input type="text" id="email_smtp_server" name="email_smtp_server" 
                               value="{{EMAIL_SMTP_SERVER}}" placeholder="smtp.gmail.com">
                    </div>
                    
                    <div class="form-group">
                        <label for="email_smtp_port">SMTP Port:</label>
                        <input type="number" id="email_smtp_port" name="email_smtp_port" 
                               value="{{EMAIL_SMTP_PORT}}" placeholder="587">
                        <div class="help-text">587 for TLS, 465 for SSL, 25 for plain</div>
                    </div>
                    
                    <div class="form-group">
                        <label>Encryption:</label>
                        <div class="flex-row">
                            <label>
                                <input type="radio" name="email_encryption" value="tls" {{EMAIL_TLS_CHECKED}}> TLS
                            </label>
                            <label>
                                <input type="radio" name="email_encryption" value="ssl" {{EMAIL_SSL_CHECKED}}> SSL
                            </label>
                            <label>
                                <input type="radio" name="email_encryption" value="none" {{EMAIL_NONE_CHECKED}}> None
                            </label>
                        </div>
                        <div class="help-text">Choose one encryption method</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="email_from">From Email:</label>
                        <input type="email" id="email_from" name="email_from" 
                               value="{{EMAIL_FROM}}" placeholder="backup@yourcompany.com">
                    </div>
                    
                    <div class="form-group">
                        <label for="email_to">To Email:</label>
                        <input type="email" id="email_to" name="email_to" 
                               value="{{EMAIL_TO}}" placeholder="admin@yourcompany.com">
                    </div>
                    
                    <div class="form-group">
                        <label for="email_username">SMTP Username:</label>
                        <input type="text" id="email_username" name="email_username" 
                               value="{{EMAIL_USERNAME}}" placeholder="your.email@gmail.com">
                        <div class="help-text">Usually your email address</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="email_password">SMTP Password:</label>
                        <input type="password" id="email_password" name="email_password" 
                               value="{{EMAIL_PASSWORD}}" placeholder="your-app-password">
                        <div class="help-text">Use app password for Gmail</div>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <input type="submit" value="Save Configuration" class="button button-success">
                <a href="/" class="button">Cancel</a>
            </div>
            
        </form>
        
        <div class="config-section">
            <h3>Advanced Options</h3>
            <p>
                <a href="/config/raw" class="button">Edit Raw YAML</a>
                <a href="/reload-config" class="button">Reload from File</a>
                <a href="/backup-config" class="button button-warning">Download Backup</a>
            </p>
        </div>
    </div>
    
</body>
</html>