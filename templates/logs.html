<!DOCTYPE html>
<html>
<head>
    <title>Inspect System - Highball</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="{{THEME_CSS_PATH}}">
    <script src="/static/nav.js"></script>
    <script src="/static/network-scan.js"></script>
</head>
<body>
    <div class="container">
        <div id="navigation"></div>
        
        <h1>Inspect System</h1>
        
        <!-- Network Scanner Container -->
        <div class="section-container">
            <h2 class="section-header">Network Scanner</h2>
            <p>Scan your network for available rsync servers and their modules.</p>
            <input type="text" id="networkRange" placeholder="192.168.1.0/24" class="w-150">
            <div class="mt-15">
                <button id="scanNetwork" class="button button-warning">Scan Network for Rsync Servers</button>
            </div>
            <div id="scanResults" class="hidden mt-15">
                <h4>Found Rsync Servers:</h4>
                <div id="scanOutput" class="code-container log-container" style="height: 200px;"></div>
            </div>
        </div>
        
        <!-- Restic Browser Container -->
        <div class="section-container">
            <h2 class="section-header">Restic Repository Browser</h2>
            <p>Browse snapshots and files in Restic repositories.</p>
            <select id="resticJobSelect" onchange="loadResticRepository()">
                <option value="">Select a Restic job...</option>
                {{RESTIC_JOB_DROPDOWN}}
            </select>
            <div id="resticBrowserContent" class="hidden restic-browser">
                <div id="resticRepositoryInfo" class="restic-repository-info">
                    <!-- Repository information will be displayed here -->
                </div>
                <div id="resticSnapshotList" class="restic-snapshot-list">
                    <!-- Snapshot browser will be implemented here -->
                </div>
            </div>
        </div>
        
        <!-- Log Sources Container -->
        <div class="section-container">
            <h2 class="section-header">Log Sources</h2>
            {{LOG_BUTTONS}}
            
            <div class="log-section">
                <label for="jobSelect">Job Logs:</label>
                <select id="jobSelect" onchange="viewJobLog()">
                    {{JOB_DROPDOWN}}
                </select>
            </div>
            
            <div class="log-section">
                <button id="refreshLogs" class="button">Refresh</button>
                <button id="clearLogs" class="button button-warning">Clear Display</button>
            </div>
            
            <h3>{{LOG_NAME}}</h3>
            <div id="logContent" class="log-viewer">{{LOG_CONTENT}}</div>
        </div>
    </div>

    <script>
        const logContent = document.getElementById('logContent');
        const refreshButton = document.getElementById('refreshLogs');
        const clearButton = document.getElementById('clearLogs');
        
        function viewJobLog() {
            const jobSelect = document.getElementById('jobSelect');
            const jobName = jobSelect.value;
            if (jobName) {
                window.location.href = `/logs?job=${encodeURIComponent(jobName)}`;
            } else {
                // Return to system logs
                window.location.href = '/logs';
            }
        }
        
        function refreshLogs() {
            // Reload the current page to refresh log content
            window.location.reload();
        }
        
        function clearLogs() {
            logContent.textContent = '';
        }
        
        // Event listeners
        refreshButton.addEventListener('click', refreshLogs);
        clearButton.addEventListener('click', clearLogs);
        
        // Restic browser functions (scaffold)
        function loadResticRepository() {
            const resticJobSelect = document.getElementById('resticJobSelect');
            const browserContent = document.getElementById('resticBrowserContent');
            const repositoryInfo = document.getElementById('resticRepositoryInfo');
            const snapshotList = document.getElementById('resticSnapshotList');
            
            if (resticJobSelect.value) {
                const jobName = resticJobSelect.value;
                
                // TODO: Implement repository browsing
                repositoryInfo.textContent = `Loading repository information for ${jobName}...`;
                snapshotList.textContent = 'Snapshot browser not yet implemented';
                browserContent.classList.remove('hidden');
            } else {
                browserContent.classList.add('hidden');
            }
        }
    </script>
</body>
</html>
